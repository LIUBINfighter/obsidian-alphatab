# 方案C：自定义字体族名，彻底规避 AlphaTab 内部字体注入冲突

## 背景

AlphaTab 内部会根据 `settings.core.smuflFontSources` 自动生成名为 `alphaTab` 的 `@font-face` 规则，但其 `src` 存在 bug（会变成 JSON.stringify 过的 data URI），导致浏览器加载失败，并引发 `NetworkError`。  
如果我们也用 `alphaTab` 作为字体族名，浏览器会遇到多个同名规则，且可能优先使用 AlphaTab 注入的错误规则，导致 `document.fonts.load('1em alphaTab')` 失败，渲染中断。

## 方案核心

- **完全自定义字体族名**，如 `UserBravura` 和 `UserAlphaTabMusic`，避免与 AlphaTab 内部冲突。
- 手动注入正确的 `@font-face` 规则，绑定到自定义族名。
- 在 `settings.display.resources.musicFont` 和 `smuflFont` 里，全部使用自定义族名。
- 在 `renderStarted` 事件中兜底覆盖，确保渲染时始终用自定义族名。
- 允许 AlphaTab 内部继续注入它的 `alphaTab` 字体规则（会报错），但我们不再依赖它。

## 步骤

1. **注入自定义 @font-face**
   - 生成 `UserBravura`、`UserAlphaTabMusic` 的 `@font-face`，`src` 指向正确的 data:URL。
2. **设置 AlphaTab 配置**
   - `settings.display.resources.musicFont.families` 和 `smuflFont.families` 都设为 `[ 'UserBravura', 'UserAlphaTabMusic' ]`。
3. **渲染事件兜底**
   - `renderStarted` 事件中再次覆盖 `smuflFont.families`，防止被 AlphaTab 内部覆盖。
4. **字体预加载**
   - 用 `FontFace` API 和隐藏 div 预加载自定义字体族。
5. **容忍 AlphaTab 的错误日志**
   - 只要渲染正常，忽略其 `alphaTab` 相关的字体加载错误。

## 预期效果

- AlphaTab 渲染引擎只会用我们自定义的字体族，且这些族有正确的字体定义。
- 浏览器不会再因同名 `@font-face` 冲突导致字体加载失败。
- 只要 Data URI 字体可用，渲染应恢复正常。

---
